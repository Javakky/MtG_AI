# VI. MCTS ALGORITHM DESIGN FOR M:TG

---

## 組み合わせ爆発

M:TGのデッキは60枚、プレイヤーは2人いるので`2*(60!)`通りのデッキ順が想定される

実際には以下の理由により組み合わせは減少するが、それでもすべてを計算するのは困難である

- 同名のカードが入れられる
    - デッキ内のカードの種類は15種程度
- デッキのカードすべてを引ききらないことが多い
    - ゲームで使うカードは20枚程度

---

## A. Relevance of individual MCTS trees

---

### カード順序の確定に必要なこと

- これまでのゲーム内容と合致すること
- 片方のプレイヤーが極端に勝ちやすいようなバイアスを避けること

---

### 「interesting」なカード順序

以下の状況でゲーム結果が異なるような順序

- 意図的に手を打たない (ターンを返す)
- Expert rule-base Player の指示した手を打つ

パスしてもプレイしても結果が変わらない → デッキがどちらかのプレイヤーに著しく有利な順序

---

### カード順序の選択

1. いくつかの順序候補に対し、'interesting'かどうかテストを行う
    1. 2回のロールアウトを実行する
    2. 片方は「手を打たない」
    3. 片方は「Expert rule-base Player」の指示に従う
    4. 双方の対戦結果が異なる場合、'interesting'に分類される
2. 1つの順序候補に対して複数回のテストを行う
3. 'interesting'に1度でも分類された順序を用いる
4. 見つからない場合にはランダムな順序を利用する

---

### 実行時間

2種類の検証方法の実行時間は以下のようになった

1. MCTSに配置されたそれぞれの葉ノードにテストを行う
    - 実行時間が2倍に増加した
2. ルートノードのみでテストを行う
    - 実行時間はほとんど変化しなかった

⇒ 手法 2. を用いる

---

## B. Structure of the MCTS tree

---

5マナ下で、A(5コスト)、B(3コスト)、C(2コスト)のカードがある場合、選択肢を図のように刈り取る

![Fig. 3](C:\Users\mi161303\Desktop\卒業研究\resource\Fig_3.png)

---

### 刈り込み手法

1. 土地をプレイできる場合、必ず土地をプレイする
    - 土地をプレイしないことは戦略的にほとんど意味がない
2. dominated move pruning を行う

---

### dominated move pruning (支配的な)

ある手が他の手のサブセットであった場合、その手を刈り取る。
(可能な限りさ最大枚数プレイする)

---

要約して、以下の3段階で調査する。

1. 剪定しない
2. 土地を必ずプレイする
3. プレイするカードがなるべく多くなるようにプレイする

---

### MtGの特徴

- あるターンに利用可能な動きは、手札の全ての組み合わせのサブセットである
- プレイされたカードはゲーム中アクティブなままである

---

### Binary decisions (二分木)

プレイするカードを2分木で表す

![Fig. 4](C:\Users\mi161303\Desktop\卒業研究\resource\Fig_4.png)

---

× 手札の枚数によって木の深さが増大する

○ あるカードをプレイするべきかが他のカードと独立して情報蓄積できる

---

- やること
    - カードのプレイについて2分木を用いる

- やらないこと
    - アタッカーやブロッカーの選択に2分木を用いる

---

重要な決定は二分木の上部に位置することが望ましいが、先験的に重要度を決定することは困難である

<br>

マナ・コストに基づく昇順/降順/ランダムな順序付けの間に有意な差は示されなかった

<br>

(感覚的には)大型クリーチャーを先に出す方が強いため、マナコストの降順を用いる

---

### Simulation strategies (シミュレーション戦略)

- 発見的手法によってよりよいパフォーマンスが出る

- ロールアウトに使用される(対戦相手想定の手が)強ければ強いほど良い結果がでるわけではない

---

以下の3種類で検証した

1. expert rule-based player
2. reduction rule-based player
3. random

---

### Discounted reward (減らされた報酬)

MCTSでは極端に有利(不利)な状況では弱い手を打つことが多い

→ 適度にプレッシャーをかけることが必要

---

```
γ := 基本報酬
t := 現在のルート状態から終末状態に到達するターン
λ := 0<λ≦1の割引パラメータ
```

ここで、報酬は $$ \gamma {\lambda}^t $$ で表される

---

#### 割り引きパラメータ

パラメータλは0.99を代入した 標準的なM:tGのターン数40～60において0.7～0.5の幅となるため

---

#### 基本報酬

敗北報酬γは0にしたときと-1にしたときを検証する
(勝利報酬は+1)

敗北報酬に―1を設定すると、試合が長くなるように行動するため、運によって勝利に持ち込める可能性を高めることができると考えられる

